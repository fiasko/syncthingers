# Syncthingers

A lightweight, Rust-based singleton system tray application for Windows to manage a local Syncthing instance.

# Personal project target
This project is a learning project for AI prompt coding and Rust language for me. ~95% of the code and documentation is generated by Github Copilot using Calude 3.7, 4 and GPT 4.1 mostly in agent mode. Copilot was used also to generate git commit messages, which is why they are quite unprofessional looking and often a bit messy. Future plan is to sort out the code more manually and make it more clean. But that remains to be seen.

## Features
- **Singleton enforcement:** Only one instance can run at a time.
- **System tray UI:** Start and stop Syncthing, monitor status, open web UI, and access configuration from the tray.
- **Cross-platform process management:** Uses sysinfo for robust process monitoring and control across platforms.
- **External process control:** Can detect and stop both app-managed and external Syncthing processes.
- **Configurable:** Application settings in `configuration.json`. Automatically updates configuration files when new options are added.
- **Auto-launch:** Optionally auto-start internal Syncthing when no external instance is running.
- **Logging:** Log key events and errors to a file with configurable verbosity.
- **Robust error handling:** User feedback via logs and native dialogs for critical errors.
- **Console-free operation:** Prevents console windows from appearing when managing Syncthing processes.
- **Future-ready:** Platform-independent API design for potential cross-platform support.
- **Command-line config creation:** Use `--create-config` to only create the default config file and exit.

## Additional Features
- **User directory for configuration:** Settings are stored in the user's AppData directory on Windows (specifically `%LOCALAPPDATA%\Syncthingers`).
- **Portable mode:** Use `--portable` flag to store configuration and logs in the current directory.
- **Automatic Syncthing detection:** Automatically finds Syncthing executable in system PATH during setup.
- **Process tree termination:** Properly terminates Syncthing and all child processes when stopping.
- **Configuration migration:** Automatically migrates configuration from the executable directory if found.

## Future Features
- **Transfer speed monitoring:** Monitor info like transfer speed from Syncthing using web API.
- **Remote Syncthing management:** Monitor Syncthing services from other computers and servers.
- **Windows auto-start:** Start tray app automatically with Windows.
- **Real-time configuration monitoring:** Monitors `configuration.json` for file changes and automatically applies updates without restart.
- **Configuration validation:** Validates configuration files on load and change, with detailed error reporting and user notifications.


## Getting Started
1. **Clone the repository:**
   ```sh
   git clone <repo-url>
   cd syncthingers
   ```
2. **Install Rust:** [https://rustup.rs/](https://rustup.rs/)
3. **Build the app:**
   ```sh
   cargo build --release
   ```
4. **Configure:**
   - Edit `configuration.json` to set your Syncthing path, web UI URL, log level, and startup arguments.
   - Or run:
     ```sh
     target\release\syncthingers.exe --create-config
     ```
     to only create the default config file (if it doesn't exist) and exit.
5. **Run:**
   ```sh
   target\release\syncthingers.exe
   ```

## Command-Line Arguments

- `--log-level=<level>`: Set the initial log level for the app. Supported values: `off`, `error`, `warn`, `info`, `debug`. Example: `--log-level=debug`
- `--create-config`: Only create the default configuration file (if it doesn't exist) and exit. No tray or Syncthing process will be started.
- `--portable`: Run in portable mode. Configuration and log files will be stored in the current working directory instead of the user's AppData folder.

You can combine these arguments as needed. For example:

```powershell
# Create configuration and exit
syncthingers.exe --create-config

# Run in portable mode with debug logging
syncthingers.exe --portable --log-level=debug

# Normal startup with custom log level
syncthingers.exe --log-level=info
```

## Directory Structure
```
assets/
  icons/                       # .ico files for tray (running/stopped)
  app.manifest                 # Windows application manifest
src/                           # Rust source code
docs/                          # Documentation files
%LOCALAPPDATA%\Syncthingers\   # User configuration directory (Windows)
  configuration.json           # App configuration
  syncthingers.log             # Log file
```

> **Note:** Use `--portable` flag to store configuration and logs in the current directory instead of AppData.

## Configuration Example
```json
{
  "log_level": "info",
  "syncthing_path": "C:/Program Files/Syncthing/syncthing.exe",
  "web_ui_url": "http://localhost:8384",
  "startup_args": ["-no-browser"],
  "process_closure_behavior": "close_managed",
  "auto_launch_internal": false
}
```

### Configuration Options

- **log_level**: Set the logging level (`off`, `error`, `warn`, `info`, `debug`)
- **syncthing_path**: Full path to the Syncthing executable (automatically detected if in PATH)
- **web_ui_url**: URL for the Syncthing web interface (default: `http://localhost:8384`)
- **startup_args**: Command line arguments passed to Syncthing when starting (default: `["-no-browser"]`)
- **process_closure_behavior**: Controls what happens to Syncthing processes when the app exits:
  - `"close_all"`: Closes all Syncthing processes (both managed and external)
  - `"close_managed"`: Only closes processes started by this app (default)
  - `"dont_close"`: Leaves all Syncthing processes running
- **auto_launch_internal**: Automatically start internal Syncthing if no external instance is running (default: `false`)

## Development
- See `TODO.md` for a step-by-step development plan and best practices.
- See `docs/` directory for detailed documentation on various features and components.
- The codebase is organized for clarity, maintainability, and future cross-platform support.
- Run tests with `cargo test` - all 18 tests should pass.

## Documentation
- **`docs/process.md`**: Process management and monitoring documentation
- **`docs/tray_ui.md`**: System tray UI implementation details

## Project Status
This project is feature-complete for basic Syncthing management. Key completed features:
- ✅ Cross-platform process management with sysinfo
- ✅ External Syncthing process detection and control
- ✅ Console window prevention for clean operation
- ✅ Auto-launch internal Syncthing capability
- ✅ Comprehensive configuration management
- ✅ Portable mode support

## License
MIT
